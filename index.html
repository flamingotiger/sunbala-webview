<!DOCTYPE html>
<html lang="en">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>주소검색</title>
  </head>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
    #full-size {
      height: 100%;
      width: 100%;
      overflow: hidden; /* or overflow:auto; if you want scrollbars */
    }
  </style>
  <body>
    <div id="full-size"></div>
  </body>
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=953a9e73d310a7198314ec6c4e7f491c&libraries=services"></script>
  <script type="text/javascript">
    // 우편번호 찾기 화면을 넣을 element
    var element_layer = document.getElementById("full-size");

    daum.postcode.load(function () {
      new daum.Postcode({
        oncomplete: function (data) {
          console.log(data);
          // 우편번호와 주소 정보를 해당 필드에 넣는다.

          Promise.resolve(data)
            .then((o) => {
              const { address } = data;
              return new Promise((resolve, reject) => {
                const geocoder = new daum.maps.services.Geocoder();

                geocoder.addressSearch(address, (result, status) => {
                  if (status === daum.maps.services.Status.OK) {
                    const { x, y } = result[0];

                    resolve({ lat: y, lon: x });
                  } else {
                    reject();
                  }
                });
              });
            })
            .then((result) => {
              // 위, 경도 결과 값
              // lat: "37.4777556513689"
              // lon: "127.049401327634"
              console.log(result);
              console.log('window.getAddressWebToApp', window.getAddressWebToApp);
              if (
                window.getAddressWebToApp &&
                window.getAddressWebToApp.postMessage
              ) {
                getAddressWebToApp.postMessage(
                  JSON.stringify({ address: { ...data, ...result } })
                );
              }
            });
        },
        width: "100%",
        height: "100%",
        maxSuggestItems: 5,
        alwaysShowEngAddr: false,
        hideMapBtn: true,
        hideEngBtn: false,
      }).embed(element_layer);

      // iframe을 넣은 element를 보이게 한다.
      element_layer.style.display = "block";
    });
  </script>
</html>
